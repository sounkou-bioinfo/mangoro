---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  out.width = "100%"
)
```

R/Go IPC with Nanomsg Next Gen

## Test echo server setup

```{r echo-server, message=TRUE, warning=TRUE}
library(mangoro)
library(nanonext)
library(processx)

# Create a unique IPC path for the test
tmp_ipc <- tempfile(pattern = "mangoro-echo", fileext = ".ipc")
if (.Platform$OS.type == "windows") {
  ipc_url <- paste0("ipc://", gsub("/", "\\\\", tmp_ipc))
} else {
  ipc_url <- paste0("ipc://", tmp_ipc)
}

# Start echo server in background
bin_path <- find_mangoro_bin("echo")
echo_proc <- processx::process$new(bin_path, args = ipc_url)
Sys.sleep(1) # Give server time to start

# Connect as client and test echo
sock <- nanonext::socket("req", dial = ipc_url)
msg <- "hello from R"
nanonext::send(sock, msg)
reply <- nanonext::recv(sock)
reply
# Cleanup
close(sock)
echo_proc$kill()
```
